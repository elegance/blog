---
title: 再理一遍OAuth2.0
tags:
---
`oauth`印象中已经啃过几次了。大多数时候，好记性还是不如烂笔头，对自己的记忆力太过自信了，当时理解了，觉的妙，但是现在只记得一个妙字了，至于其它的已经忘的差不多了...

所以最好趁自己刚理解的那一刻，赶紧的自己组织语言记录下来。

## 概念

首先，想到`OAuth 2.0`，脑海中先简化浮出以下概念：
* **资源提供者**
* **用户(资源拥有者)**
* **获取资源者**

在来挨个解释下，**资源提供者**，好比新浪微博提供了发微博、获取微博列表，百度网盘提供了存储文件、访问文件列表的服务，其中新浪微博、百度网盘都是资源的提供者。**用户**就是资源拥有者，具体的某条微博、网盘里的某个照片都是具体用户的，没有得到用户允许，资源提供者不可供其他应用使用。**获取资源者** 就是一些非资源提供者的应用想要访问这些资源，比如一款冲印照片的应用需要访问你网盘里的照片。

搞清楚了这些概念后，如果你要做应用，最好确定下你是要做**提供者的应用** 还是**获取者的应用**，前者相当于是要在基于现有服务，整理好资源提供一整套`OAuth 2.0`的Server，后者作为一个`OAuth 2.0`的Client相对较为简单。

## 软件架构概念
有了以上的概念我们就能从宏观上来理解为什么会有OAht2.0的存在。如果要从软件上来实现它，基于以上三者，我们还需要细分一下，如下：
* 资源提供者
    * **HTTP service**: HTTP服务提供商
    * **Resource Server**: 资源服务器，可能你需要整理归类下现有的资源，有的资源可能不需要列入资源服务器。
    * **Authorization server**: 认证服务，提供资源的授权服务
* 用户(资源拥有者)
    * **Resource Owner**: 资源拥拥有者，用户
    * **User Agent**: 用户代理，这个就代表着用户，一般就是浏览器、操作界面。
* 获取资源者
    * **Third-part application**： 第三方应用程序

## 应用
* 作为第三方应用，避免注册环节，用微博、微信、QQ等登录/注册
* 作为三方应用，访问用户的资源，比如分享微博，打印网盘照片等


## 机制
appid/secrect/  code 、token

## 安全
从以上的实现机制，可以看出最终是为了得到`token`。其实这个`token`与平时web会话客户端的那个 `sessionid`的本质意义是一样的，都是用户的身份标识。
为了`sessionid`的安全我们一般会做两点，后台设置的response cookie是`httpOnly`的，也就是js不可读取保证客户端安全，另外就是使用`https`保证传输通道的安全。按照这个思路我们可以类比下这个`token`该怎么在安全方面有所保障。

---
## 参考
* [简述 OAuth 2.0 的运作流程](http://www.barretlee.com/blog/2016/01/10/oauth2-introduce/)
* [Oauth的access token 安全么?](https://www.zhihu.com/question/20274730)
* [理解OAuth 2.0](http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html)