---
title: 字符编码
tags: 编码
---
从刚接触计算机理论起，就被灌输这是一台只认识0、1的机器，数字、字符串、声音、图像、视频等都可以在计算机中表示，这就是所谓的数字化吧。

### 大于0、1的整数表示
既然说到了，字符编码，想必已经理解了这个问题`只有0、1怎么表示2、3、4这些数字呢？`，表示如下
```
0000 -> 0
0001 -> 1
0010 -> 2
0011 -> 3
0100 -> 4
...
```
采用进位使用多个bit位来表示就可以了，小数的表示这里就不展开说了，有兴趣的可以从这里看。

#### TODO: 内存位置, 
bit 单元格，内存里面茫茫一片的`01...`， 内存并不去区分这个`01`是`十进制1中的01`，还是`10进制2中的01`  ，怎么区分这个交由具体的程序去做， [关于CPU位数，OS位数以及内存大小关系](http://www.cnblogs.com/little-YTMM/p/5058354.html)

内存位置16进制编号，一个网格，网格上每个都有编号，用16进制表示，`0x....`表示

程序指引 int a = 1; int b = 1

### 字符编码
进入今天的正题`字符编码`，同样的问题`0、1怎么来表示字符呢，比如hello、你好？`

**抽象的字符编码层面：把一个字符“编码”到一个数字**

**具体的字符编码层面：把抽象层面的数字“编码”成最终的储存形式，明确是定长还是变长；定长的话是定几个字节；用变长的话有哪几种字节长度，具体如何实现；**

#### Unicode 与 UTF-X
[脑图](http://naotu.baidu.com/file/91e22aa3101b248bb9fb207c7d878826)

* Unicode 只是符号集，规定了符号与二进制代码的关系，没有规定二进制代码应该如何存储
* UTF-X 根据Unicode来进行存储，涉及具体的编码; 
    * 最终的存储形式 定长还是变长；
    * 如果是变长有哪几种字节长度，具体如何实现；

一般来说，字符集(关系表) 与 具体实现的编码是，1对1的关系，像ASCII、GB2312(EUC-CN存储)等，但是 Unicode 与 UTF-X 是1对多的，UTF-X 有UTF-8、UTF-16、UTF-32等

#### Unicode 码点(code point)

* 码点格式：表现形式`U+[XX]XXXX`，X为16进制数字，**4-6位表示**。
* 码点范围：码点范围: `U+0000~U+10FFFF`；两种理解思路:
    1. `U+10FFFF` 1*16^5 + 16^4 = 1114112
    2. `U+10FFFF + 1 = U+110000`个，前一个1是后一个1的16倍，`(16+1) * 65536 = 1114112`
* 17个面，每个面可表示65536个符
    * BMP(Basic Multilingual Plan 基本多语言平面) [BMP字符集](http://unifoundry.com/pub/unifont-7.0.03/unifont-7.0.03.bmp)
    * SP(Supplementary Plans 增补平面)

#### 编码单元 (code unit)
`UTF-X` 中`X`就代表了多少个比特位表示一个编码单元。`Unicode`码点最大`10FFFF`最大21位

UTF-8: 8bit即单字节为1个编码单元，UTF-16: 16bit即2个字节为1个编码单元, UTF-32：32bit即4个字节为1个编码单元

#### 定长编码 与 变长编码
定长编码：意味着这类编码使用固定长度的字节，如`ASCII`固定占1个字节长度、`UTF-32`固定占4个字节长度。特点：复杂度低，其存在的问题是**定多长，定少了不够用，定多了浪费空间**

变长编码：字符所占长度不固定，如`UTF-8`占1/2/3/4个字节长度、`UTF-16`占2/4个字节长度。特点：具有一定复杂度，其核心解决的问题是**如何区分不同的变长字节**

定长编码的读取我们好理解，一次读固定长度的字节，根据码表将二进制翻译字符显示即可；写入时根据字符翻译成二进制，不足固定长度，向前补0即可；

那变长编码的读取和写入呢？

#### UTF-8
`UTF-8`：`UTF-8`利用高位保留来做区分来解决上面提到的**如何区分不同的变长字节**问题，缺点就是减少了有效编码空间

UNICODE码点范围  |	UTF-8 |	UTF-8二进制                         | 有效编码
-----------------|--------|-------------------------------------|
U+0000~U+007F	 |1字节	  |0XXXXXXX	                            |2^7=128个(ASCII)
U+0080~U+07FF	 |2字节	  |110XXXXX 10XXXXXX	                |2^11=2048个
U+0800~U+FFFF	 |3字节	  |1110XXXX 10XXXXXX 10XXXXXX	        |2^16=65536个
U+010000~U+10FFFF|4字节	  |11110XXX 10XXXXXX 10XXXXXX 10XXXXXX	|2^21=2097152个

* UTF-8多字节二进制规则：**首字节前n位为1，n+1位为0；后面字节前两位为0**
* UTF-8多(n)字节有效编码位：`(n*8)-(n+1+(n-1)*2)=5n+1`

上面有效编码可以看出来，ASCII段占1个字节、大多数字符是占1或者3个字节的，一些生僻极其罕见的才会占4个字节

#### UTF-16
`UTF-16`: `UTF-16`是使用所谓的代理区来实现。

大多数占2个字节，生僻极其罕见的占4个字节。