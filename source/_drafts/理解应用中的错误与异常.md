---
title: 理解应用中的错误与异常
tags:
---

异常：超出期望范围

错误：
    业务错误：尽量避免错误的发生，前端js预先检验，后端再检验
    系统错误：内存不足、未处理空指针

简单的看错误是可以预知的，异常应该抛出，

## 举个例子
拿注册来说, 界面上有：手机号码、密码、短信验证码

业务要求：手机号码不可重复，密码不能少于6位

系统结构有：后台api提供服务、前端静态项目(js+html+css)

后台api有接口：
1. get: `/api/checkMobilePhone`， 参数：mobilePhone，返回：0 可用，1 不可用
2. get: `/api/sendSms`，参数：mobilePhone，返回：无内容，http 200状态即发送成功
2. get: `/api/checkSmsCode`，参数：mobilePhone、smsCode，返回：0 正确，1 错误
3. post: `/api/register`，参数：mobilePhone、password、smsCode，返回：无内容，http 200 则视为成功

前端一般做法：
1. `blue`时验证用户输入的手机号码是否合法、通过`ajax`调用接口`/api/checkMobilePhone`检测手机是否已经存在：可用则启用"发送验证码"按钮，否则禁用"发送验证码"按钮
2. `点击`“发送验证码”按钮时 , `ajax`调用接口`/api/sendSms`发送短信验证码，正常通信返回 则tip验证码已发送，按钮禁用，进入指定倒计时
3. 填写短信验证码，`blue`时，发起`ajax`调用接口`/api/checkSmsCode`后台来检验：返回0 则启用"注册"按钮，否则禁用"注册"按钮
4. 填写密码，`blue`时js检查是否符合要求
5. 全部填写完毕，点击注册按钮，发起注册请求`/api/register`，判断通信返回是否成功，来决定后续步骤。

6. 前端 `ajax` 有全局的通信异常处理，来统一的处理异常行为。

那么有什么问题呢？
1. js在客户端执行，完全可能被篡改、禁用，但大多数人不会这么做；如果客户端禁用了js，后台在`/api/register`接口中并没有对短信验证码、手机号、密码等做再次检测 ，则有可能发生
    * sql 数据库报错，重复的手机号
    * 没有验证码也可以注册成功
    * 没有输入密码或者少于6位的密码也可以注册成功
作为后台程序必须将这些少数的情况一并考虑到，对业务要求的条件一一再次检验；检测不同过可以采用**抛出异常**、**正常返回-用代码区分正确与错误**，抛出异常其实也是可以理解的，预期这些检查都应该再客户端进行过了，但是客户端不怀好意的禁用了js，则异常返回；

2. 依赖的短信发送方异常怎么办
直接抛出通信异常，客户端捕获弹出并不能理解后台到底发生了什么错误，这个时候后台应该自定义异常，后台在调用三方短信接口时，捕获异常，抛出自定异常。

### 后台收集前端发生的错误，分级别
